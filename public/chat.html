<!DOCTYPE html>
<html>
<head>
  <title>Chat</title>
</head>
<body>

<h2>Chat Room</h2>
<button onclick="logout()">Logout</button>

<div id="messages"></div>

<form id="form">
  <input id="input" autocomplete="off" />
  <button>Send</button>
</form>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();

fetch("/checkAuth")
  .then(res => res.json())
  .then(data => {
    if (!data.loggedIn) {
      window.location.href = "/login.html";
    } else {
      socket.emit("joinRoom", data.user);
    }
  });

const form = document.getElementById("form");
const input = document.getElementById("input");
const messages = document.getElementById("messages");

form.addEventListener("submit", e => {
  e.preventDefault();
  if (input.value) {
    socket.emit("chatMessage", input.value);
    input.value = "";
  }
});

socket.on("message", msg => {
  const div = document.createElement("div");
  div.innerHTML = `<strong>${msg.user}:</strong> ${msg.text}`;
  messages.appendChild(div);
});

function logout() {
  window.location.href = "/logout";
}
</script>

</body>
</html>
